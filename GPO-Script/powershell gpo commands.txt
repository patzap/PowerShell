# Referenced by: TechSnips -> https://www.youtube.com/watch?v=7hoQcEqIUYE
# Commands will be used on the control statement 


Get-GPO -Name "No Shutdown"
$gpoGuid = (Get-GPO -Name 'No Shutdown').Id.ToString()




$domainController = 'ServerDC1'
$domainName = "zapa0013.local"
$registryPolPath = "\\$domainController\sysvol\$domainName\Policies\{$gpoGuid}\User"
Get-ChildItem -Path $registryPolPath
$regPolPath = Join-Path -Path $registryPolPath -ChildPath 'registry.pol'
Parse-PolFile -Path $regPolPath
$regKeyInfo = Parse-PolFile -Path $regPolPath
$gponame = "No Shutdown PS"
New-GPO -Name $gponame -Comment "Powershell Version of No Shutdown"
$gpRegParams = @{
Name       = $gponame
Key        = "HKCU\$($regKeyInfo.KeyName)"
ValueName  = $regKeyInfo.ValueName
Type       = $regKeyInfo.ValueType
Value      = $regKeyInfo.ValueData
}
Set-GPRegistryValue @gpRegParams 
$ou = 'Test2OU'
$domainDn = (Get-ADDomain).DistinguishedName
$ouDn = "OU=$ou,$domainDn"
New-GPLink -Name $gpoName -Target $ouDn -LinkEnabled 'Yes'